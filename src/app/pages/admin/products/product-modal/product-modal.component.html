<!-- Overlay -->
<div
  class="fixed inset-0 bg-black bg-opacity-50 z-50
         flex items-start sm:items-center justify-center
         overflow-y-auto"
  (click)="closeModal()">

  <!-- Modal Box -->
  <div
    class="bg-white w-full max-w-4xl
           rounded-lg shadow-lg
           p-4 sm:p-6
           mx-2 my-6
           relative
           max-h-[90vh] overflow-y-auto"
    (click)="$event.stopPropagation()">

    <!-- Header -->
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg sm:text-xl font-semibold">
        {{ product ? 'Edit Product' : 'Add Product' }}
      </h2>

      <button
        (click)="closeModal()"
        class="text-gray-500 hover:text-red-600 text-xl">
        ✕
      </button>
    </div>

    <!-- CONTENT + IMAGES (SAME ROW) -->
    <div class="flex flex-col md:flex-row gap-6 items-stretch">

      <!-- LEFT : FORM -->
      <div class="flex-1 space-y-4">

        <!-- Category -->
        <div>
          <label class="block text-sm font-medium mb-1">Category</label>
          <select
            [(ngModel)]="form.categoryId"
            class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
            <option value="">Select Category</option>
            <option *ngFor="let c of categories" [value]="c.id">
              {{ c.name }}
            </option>
          </select>
        </div>

        <!-- Name -->
        <div>
          <label class="block text-sm font-medium mb-1">Product Name</label>
          <input
            type="text"
            [(ngModel)]="form.name"
            class="w-full border rounded px-3 py-2" />
        </div>

        <!-- Price -->
        <div>
          <label class="block text-sm font-medium mb-1">Price</label>
          <input
            type="number"
            [(ngModel)]="form.price"
            class="w-full border rounded px-3 py-2" />
        </div>

        <!-- Description -->
        <div>
          <label class="block text-sm font-medium mb-1">Description</label>
          <textarea
            rows="3"
            [(ngModel)]="form.description"
            class="w-full border rounded px-3 py-2"></textarea>
        </div>
      </div>

      <!-- RIGHT : IMAGES -->
      <div class="w-full md:w-72 shrink-0 flex flex-col justify-start">
        <label class="block text-sm font-medium mb-2">Product Images</label>
        <input type="file" multiple (change)="onImagesSelect($event)" />

        <div class="flex gap-3 mt-3 flex-wrap items-center">
          <!-- Existing Images -->
          <div
            *ngFor="let img of existingImages; let i = index"
            class="relative">
            <img
              [src]="getImageUrl(img.url)"
              class="w-20 h-20 rounded object-cover border" />
            <button
              (click)="removeExistingImage(i)"
              class="absolute -top-2 -right-2 bg-red-600 text-white
                     w-5 h-5 rounded-full text-xs
                     flex items-center justify-center">
              ✕
            </button>
          </div>

          <!-- New Images -->
          <div
            *ngFor="let img of imagePreviews; let i = index"
            class="relative">
            <img
              [src]="img"
              class="w-20 h-20 rounded object-cover border" />
            <button
              (click)="removeNewImage(i)"
              class="absolute -top-2 -right-2 bg-red-600 text-white
                     w-5 h-5 rounded-full text-xs
                     flex items-center justify-center">
              ✕
            </button>
          </div>
        </div>
      </div>

    </div>

    <!-- Footer -->
    <div class="flex justify-end gap-3 mt-6">
      <button
        (click)="closeModal()"
        class="px-4 py-2 border rounded">
        Cancel
      </button>

      <button
        (click)="submit()"
        class="px-5 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Save Product
      </button>
    </div>

  </div>
</div>
